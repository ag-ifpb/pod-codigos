package test.comm;
import java.io.IOException;
import java.net.ServerSocket;
import java.net.Socket;
import java.nio.ByteBuffer;

import ag.protocol.Frame;
import ag.protocol.Transport;
import ag.protocol.impl.DefaultTransport;

public class Server {

	public static void main(String[] args) throws IOException {
		//
		System.out.println("Servidor...");
		//
		ServerSocket serverSocket = new ServerSocket(10999);
		Socket socket = serverSocket.accept();
		//
		Transport transport = new DefaultTransport(socket);
		Frame frameReq = transport.receive();
		//
		if (frameReq.isText()){
			String ok = " (received: ok)";
			ByteBuffer buf = ByteBuffer.allocate(frameReq.getLength()+ok.length());
			buf.put(frameReq.getPayload());
			buf.put(ok.getBytes());
			transport.send(frameReq.getIdentiy()+1, buf.array(), true, false);
		} else {
			
		}
		result.dump();
		//
		socket.close();
		serverSocket.close();
	}
}
